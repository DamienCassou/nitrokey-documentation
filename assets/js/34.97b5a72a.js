(window.webpackJsonp=window.webpackJsonp||[]).push([[34],{371:function(t,e,s){t.exports=s.p+"assets/img/luks_1.3209236f.png"},372:function(t,e,s){t.exports=s.p+"assets/img/luks_2.9a025489.png"},373:function(t,e,s){t.exports=s.p+"assets/img/luks_3.96a9f85c.png"},374:function(t,e,s){t.exports=s.p+"assets/img/luks_5.49fa39f2.png"},375:function(t,e,s){t.exports=s.p+"assets/img/luks_6.893024be.png"},545:function(t,e,s){"use strict";s.r(e);var a=s(33),r=Object(a.a)({},(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"full-disk-encryption-with-cryptsetup-luks"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#full-disk-encryption-with-cryptsetup-luks"}},[t._v("#")]),t._v(" Full-Disk Encryption With cryptsetup/LUKS")]),t._v(" "),a("p",[t._v("This guide shows how to configure LUKS-encrypted volumes, to authenticate at boot with "),a("a",{attrs:{href:"https://shop.nitrokey.com/shop/product/nk-pro-2-nitrokey-pro-2-3",target:"_blank",rel:"noopener noreferrer"}},[t._v("Nitrokey Pro"),a("OutboundLink")],1),t._v(" or "),a("a",{attrs:{href:"https://shop.nitrokey.com/shop/product/nitrokey-storage-2-56",target:"_blank",rel:"noopener noreferrer"}},[t._v("Nitrokey Storage"),a("OutboundLink")],1),t._v(".")]),t._v(" "),a("p",[t._v("To provide some background, cryptsetup-initramfs now has support for using OpenPGP smart cards like the Nitrokey Pro and Nitrokey Storage to unlock LUKS-encrypted volumes. Once you finish the setup, you will just need to insert your Nitrokey at boot and enter your User PIN, instead of typing in your regular disk encryption passphrase.")]),t._v(" "),a("p",[t._v("These instructions have been tested on Ubuntu 20.04 and Debian 10.")]),t._v(" "),a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"custom-block-title"},[t._v("WARNING")]),t._v(" "),a("p",[t._v("The following guide can potentially lock you out of your computer. You should be aware of these risks, and we recommend you use the script below on a secondary computer, or after a full backup as you might lose your data.")])]),t._v(" "),a("h2",{attrs:{id:"requirements"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#requirements"}},[t._v("#")]),t._v(" Requirements")]),t._v(" "),a("ul",[a("li",[t._v("An Ubuntu or Debian computer with at least one LUKS-encrypted volume.")])]),t._v(" "),a("p",[t._v("See the section below to determine which method is compatible with this guide.")]),t._v(" "),a("ul",[a("li",[t._v("A Nitrokey Pro 2 or Nitrokey Storage 2 "),a("a",{attrs:{href:"https://docs.nitrokey.com/pro/openpgp-email-encryption.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("initialized"),a("OutboundLink")],1),t._v(" with keys.")])]),t._v(" "),a("h2",{attrs:{id:"known-issues"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#known-issues"}},[t._v("#")]),t._v(" Known Issues")]),t._v(" "),a("p",[t._v("So far, the script works only with manually-partitioned volumes, that are composed of an unencrypted "),a("code",[t._v("/boot")]),t._v(" partition, and an encrypted root "),a("code",[t._v("/")]),t._v(" partition.")]),t._v(" "),a("p",[t._v("Please do not select the automatic full-disk encryption provided by the operating system you are using for this guide. You will face recurrent errors when the partitioning is done automatically, using the installation interface on Ubuntu and Debian.")]),t._v(" "),a("h2",{attrs:{id:"instructions"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#instructions"}},[t._v("#")]),t._v(" Instructions")]),t._v(" "),a("ol",[a("li",[t._v("Install dependencies")])]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" scdaemon opensc gnupg2\n\n")])])]),a("ol",{attrs:{start:"2"}},[a("li",[t._v("Create smartcard-luks directory")])]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" smartcard-luks "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" smartcard-luks\n\n")])])]),a("p",[t._v("You might use "),a("code",[t._v("sudo")]),t._v(" if required.")]),t._v(" "),a("ol",{attrs:{start:"3"}},[a("li",[t._v("Download the smartcard-luks-script")])]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" smartcard-luks "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" smartcard-luks\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("wget")]),t._v(" https://source.puri.sm/pureos/packages/smartcard-key-luks/-/raw/master/smartcard-key-luks\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("chmod")]),t._v(" +x smartcard-key-luks\n\n")])])]),a("ol",{attrs:{start:"4"}},[a("li",[t._v("Export the public key")])]),t._v(" "),a("p",[t._v("To export your public key from GnuPG's keyring:")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("\n$ gpg2 --armor --export KeyID "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" pubkey.asc\n\n")])])]),a("p",[t._v("If you already have uploaded a public key to a keyserver (or have it stored somewhere else), you should retrieve it in the way you are most comfortable with, and proceed to step 5.")]),t._v(" "),a("ol",{attrs:{start:"5"}},[a("li",[t._v("Execute the script with the pubkey.asc argument")])]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" ./smartcard-key-luks pubkey.asc\n\n")])])]),a("p",[t._v("Once, you run the script with the OpenPGP public key as argument, it automatically sets up a new LUKS secret, encrypts it against that public key, and sets up crypttab, LUKS, initramfs, and GRUB.")]),t._v(" "),a("p",[t._v("First you will be prompted for the "),a("code",[t._v("User PIN")])]),t._v(" "),a("p",[a("img",{attrs:{src:s(371),alt:""}})]),t._v(" "),a("p",[t._v("Once you unlock the Nitrokey, you will be prompted for your "),a("code",[t._v("OLD passphrase")]),t._v(". It is the passphrase you entered to encrypt your volume at intallation.")]),t._v(" "),a("p",[a("img",{attrs:{src:s(372),alt:""}})]),t._v(" "),a("p",[t._v("Notice: This is a fall-back alternative in case you lose your Nitrokey, or if it's unavailable. So far, it was not tested, and users must be aware of the risk of getting locked out of their computer, if the fall-back method does not work.")]),t._v(" "),a("p",[t._v("Once you enter the passphrase, the script finishes the setup in about one minute. Do not interrupt the script, or you might get locked out of your computer after reboot.")]),t._v(" "),a("p",[a("img",{attrs:{src:s(373),alt:""}})]),t._v(" "),a("p",[t._v("Done!")]),t._v(" "),a("p",[t._v("By now you must reboot, and you should be able to use your Nitrokey to unlock your encrypted drive.")]),t._v(" "),a("h2",{attrs:{id:"usage"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#usage"}},[t._v("#")]),t._v(" Usage")]),t._v(" "),a("p",[t._v("After reboot you should be prompted for your User PIN")]),t._v(" "),a("p",[a("img",{attrs:{src:s(374),alt:""}})]),t._v(" "),a("p",[t._v("Enter your User PIN to unlock the drive")]),t._v(" "),a("p",[a("img",{attrs:{src:s(375),alt:""}})])])}),[],!1,null,null,null);e.default=r.exports}}]);