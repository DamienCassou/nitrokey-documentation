<!DOCTYPE html>
<html lang="English">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Windows Logon and S/MIME Email Encryption with Active Directory | Nitrokey Documentation</title>
    <meta name="generator" content="VuePress 1.4.1">
    <link rel="icon" href="/favicon.png">
    <meta name="description" content="User documentation of all Nitrokey products">
    <link rel="preload" href="/assets/css/2.styles.b1b347ec.css" as="style"><link rel="preload" href="/assets/js/app.a18f3569.js" as="script"><link rel="preload" href="/assets/js/14.cafc8b87.js" as="script"><link rel="preload" href="/assets/js/11.3225be1a.js" as="script"><link rel="prefetch" href="/assets/js/0.8d28c09e.js"><link rel="prefetch" href="/assets/js/1.6ac29bd3.js"><link rel="prefetch" href="/assets/js/10.1688af8a.js"><link rel="prefetch" href="/assets/js/12.bad846f8.js"><link rel="prefetch" href="/assets/js/15.2132c396.js"><link rel="prefetch" href="/assets/js/16.5d94149b.js"><link rel="prefetch" href="/assets/js/17.976e25b4.js"><link rel="prefetch" href="/assets/js/18.57bc1d89.js"><link rel="prefetch" href="/assets/js/19.05355bce.js"><link rel="prefetch" href="/assets/js/20.603648f0.js"><link rel="prefetch" href="/assets/js/21.6420238b.js"><link rel="prefetch" href="/assets/js/22.2687e964.js"><link rel="prefetch" href="/assets/js/23.a1c36633.js"><link rel="prefetch" href="/assets/js/24.3d544d4b.js"><link rel="prefetch" href="/assets/js/25.40db387d.js"><link rel="prefetch" href="/assets/js/26.8af2f7dc.js"><link rel="prefetch" href="/assets/js/27.9357ffe8.js"><link rel="prefetch" href="/assets/js/28.f892cdde.js"><link rel="prefetch" href="/assets/js/29.3906a7fd.js"><link rel="prefetch" href="/assets/js/3.7260ee6f.js"><link rel="prefetch" href="/assets/js/30.cf6eda17.js"><link rel="prefetch" href="/assets/js/31.d902499a.js"><link rel="prefetch" href="/assets/js/32.76079b4c.js"><link rel="prefetch" href="/assets/js/33.69251b97.js"><link rel="prefetch" href="/assets/js/34.e6aeb15a.js"><link rel="prefetch" href="/assets/js/35.faaac092.js"><link rel="prefetch" href="/assets/js/36.12a9388c.js"><link rel="prefetch" href="/assets/js/37.900fe3b4.js"><link rel="prefetch" href="/assets/js/38.b0adac37.js"><link rel="prefetch" href="/assets/js/39.63b96421.js"><link rel="prefetch" href="/assets/js/4.e1ebc5c5.js"><link rel="prefetch" href="/assets/js/40.319f7f48.js"><link rel="prefetch" href="/assets/js/41.158cd07f.js"><link rel="prefetch" href="/assets/js/42.fc1e2853.js"><link rel="prefetch" href="/assets/js/43.a7db0b34.js"><link rel="prefetch" href="/assets/js/44.a1649aaf.js"><link rel="prefetch" href="/assets/js/45.cad024e0.js"><link rel="prefetch" href="/assets/js/46.880c9890.js"><link rel="prefetch" href="/assets/js/47.71957dea.js"><link rel="prefetch" href="/assets/js/48.3efa7146.js"><link rel="prefetch" href="/assets/js/49.7252d36f.js"><link rel="prefetch" href="/assets/js/5.090ec667.js"><link rel="prefetch" href="/assets/js/50.0bca9ff2.js"><link rel="prefetch" href="/assets/js/51.fdec4361.js"><link rel="prefetch" href="/assets/js/52.4202f62d.js"><link rel="prefetch" href="/assets/js/53.313cbe2c.js"><link rel="prefetch" href="/assets/js/54.8c3974af.js"><link rel="prefetch" href="/assets/js/55.c1f0dbe1.js"><link rel="prefetch" href="/assets/js/56.3771f754.js"><link rel="prefetch" href="/assets/js/57.876e826a.js"><link rel="prefetch" href="/assets/js/58.ee9eddd2.js"><link rel="prefetch" href="/assets/js/59.aa4965cc.js"><link rel="prefetch" href="/assets/js/6.51dafc16.js"><link rel="prefetch" href="/assets/js/60.74ebf8ad.js"><link rel="prefetch" href="/assets/js/61.2e5bb895.js"><link rel="prefetch" href="/assets/js/62.29ec3cd3.js"><link rel="prefetch" href="/assets/js/63.e87f76c2.js"><link rel="prefetch" href="/assets/js/64.ef9c662f.js"><link rel="prefetch" href="/assets/js/65.23404631.js"><link rel="prefetch" href="/assets/js/66.cd7dc198.js"><link rel="prefetch" href="/assets/js/67.f27f60bd.js"><link rel="prefetch" href="/assets/js/68.a358274a.js"><link rel="prefetch" href="/assets/js/69.d172e32d.js"><link rel="prefetch" href="/assets/js/7.4be33cc9.js"><link rel="prefetch" href="/assets/js/70.fd035a94.js"><link rel="prefetch" href="/assets/js/71.b17237a4.js"><link rel="prefetch" href="/assets/js/72.d0a0cfcc.js"><link rel="prefetch" href="/assets/js/73.d71e7852.js"><link rel="prefetch" href="/assets/js/8.32cdfcfe.js"><link rel="prefetch" href="/assets/js/9.46977a05.js">
    <link rel="stylesheet" href="/assets/css/2.styles.b1b347ec.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/nitrokey_logo_nur_schild_rot.svg" alt="Nitrokey Documentation" class="logo"> <span class="site-name can-hide">Nitrokey Documentation</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Product Menu" class="dropdown-title"><span class="title">Products</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fido2/" class="nav-link">
  Nitrokey FIDO2
</a></li><li class="dropdown-item"><!----> <a href="/u2f/" class="nav-link">
  Nitrokey FIDO U2F
</a></li><li class="dropdown-item"><!----> <a href="/hsm/" class="nav-link">
  Nitrokey HSM
</a></li><li class="dropdown-item"><!----> <a href="/pro/" class="nav-link">
  Nitrokey Pro
</a></li><li class="dropdown-item"><!----> <a href="/start/" class="nav-link">
  Nitrokey Start
</a></li><li class="dropdown-item"><!----> <a href="/storage/" class="nav-link router-link-active">
  Nitrokey Storage
</a></li><li class="dropdown-item"><!----> <a href="/x230/" class="nav-link">
  NitroPad X230
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/storage/windows/windows-logon-and-smime-email-encryption-with-active-directory.html" class="nav-link router-link-exact-active router-link-active">
  English
</a></li><li class="dropdown-item"><!----> <a href="/de/" class="nav-link">
  Deutsch
</a></li></ul></div></div> <a href="https://github.com/Nitrokey/nitrokey-documentation" target="_blank" rel="noopener noreferrer" class="repo-link">
    Contribute!
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Product Menu" class="dropdown-title"><span class="title">Products</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fido2/" class="nav-link">
  Nitrokey FIDO2
</a></li><li class="dropdown-item"><!----> <a href="/u2f/" class="nav-link">
  Nitrokey FIDO U2F
</a></li><li class="dropdown-item"><!----> <a href="/hsm/" class="nav-link">
  Nitrokey HSM
</a></li><li class="dropdown-item"><!----> <a href="/pro/" class="nav-link">
  Nitrokey Pro
</a></li><li class="dropdown-item"><!----> <a href="/start/" class="nav-link">
  Nitrokey Start
</a></li><li class="dropdown-item"><!----> <a href="/storage/" class="nav-link router-link-active">
  Nitrokey Storage
</a></li><li class="dropdown-item"><!----> <a href="/x230/" class="nav-link">
  NitroPad X230
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/storage/windows/windows-logon-and-smime-email-encryption-with-active-directory.html" class="nav-link router-link-exact-active router-link-active">
  English
</a></li><li class="dropdown-item"><!----> <a href="/de/" class="nav-link">
  Deutsch
</a></li></ul></div></div> <a href="https://github.com/Nitrokey/nitrokey-documentation" target="_blank" rel="noopener noreferrer" class="repo-link">
    Contribute!
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><a href="/storage/windows/" class="sidebar-link">Nitrokey Storage, Windows</a></li><li><a href="/storage/windows/two-factor-authentication-microsoft.html" class="sidebar-link">Two-factor Authentication for Microsoft Account</a></li><li><a href="/storage/windows/windows-logon-and-smime-email-encryption-with-active-directory.html" class="active sidebar-link">Windows Logon and S/MIME Email Encryption with Active Directory</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/storage/windows/windows-logon-and-smime-email-encryption-with-active-directory.html#prerequisites" class="sidebar-link">Prerequisites</a></li><li class="sidebar-sub-header"><a href="/storage/windows/windows-logon-and-smime-email-encryption-with-active-directory.html#installing-openpgp-csp" class="sidebar-link">Installing OpenPGP-CSP</a></li><li class="sidebar-sub-header"><a href="/storage/windows/windows-logon-and-smime-email-encryption-with-active-directory.html#creating-certificate-template-on-server-side" class="sidebar-link">Creating Certificate Template on Server Side</a></li><li class="sidebar-sub-header"><a href="/storage/windows/windows-logon-and-smime-email-encryption-with-active-directory.html#request-certificate-on-client-domain-member" class="sidebar-link">Request Certificate on Client (Domain Member)</a></li></ul></li><li><a href="/storage/windows/2fa-nextcloud.html" class="sidebar-link">Two-factor Authentication for Nextcloud accounts</a></li><li><a href="/storage/windows/use-with-thunderbird.html" class="sidebar-link">Use with Thunderbird</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="windows-logon-and-s-mime-email-encryption-with-active-directory"><a href="#windows-logon-and-s-mime-email-encryption-with-active-directory" class="header-anchor">#</a> Windows Logon and S/MIME Email Encryption with Active Directory</h1> <p>Please note that this driver is still in development/testing. Please tell us your experiences! See our <a href="https://www.nitrokey.com/contact" target="_blank" rel="noopener noreferrer">contact page<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <h2 id="prerequisites"><a href="#prerequisites" class="header-anchor">#</a> Prerequisites</h2> <p>This guide assumes that an Active Directory server with role 'Active Directory Certificate Services' is installed and running on a server. These instructions are based on Nitrokey Storage 2 and Nitrokey Pro 2 only.</p> <h2 id="installing-openpgp-csp"><a href="#installing-openpgp-csp" class="header-anchor">#</a> Installing OpenPGP-CSP</h2> <p>This step is needed for clients to use the OpenPGP-CSP driver. Download and install the <a href="https://github.com/vletoux/OpenPGP-CSP/releases/tag/1.3" target="_blank" rel="noopener noreferrer">latest version<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> of the installer file 'SetupOpenPGPCsp' for your system architecture, for 'SetupOpenPGPCsp_x64.msi' for 64-bit systems.</p> <p>You may want to install the driver on the server as well for being able to enforce the use of this driver in the template (see below).</p> <h2 id="creating-certificate-template-on-server-side"><a href="#creating-certificate-template-on-server-side" class="header-anchor">#</a> Creating Certificate Template on Server Side</h2> <p>On Active Directory Server open certsrv.msc to manage your certificate templates. Right click on 'Certificate Templates' and choose 'Manage'</p> <p><img src="/assets/img/1.03b2883f.png" alt="img1"></p> <p>Now right click on 'Smartcard Logon' template and click 'Duplicate', to create a new template on basis of this standard template. Rename template to 'OpenPGP Card Logon and Email' or alike.</p> <p><img src="/assets/img/2.42fe5c08.png" alt="img2"></p> <p>Under 'Request Handling', you can choose the OpenPGP-CSP as the one and only Cryptography Service Provider (click the Button labeled 'CSPs...'). For this to work, you need to install the driver on the server as well and you have to insert a Nitrokey beforehand. This is optional. You can let the user choose, which CSP to use.</p> <p><img src="/assets/img/3.0546003b.png" alt="img3"></p> <p><img src="/assets/img/4.9647a81c.png" alt="img4"></p> <p>For enabling S/MIME email encryption go to 'Subject name'. Tick the checkbox 'E-Mail name' (note: You must save the mail addresses of your users in the corresponding Active Directory field!).</p> <p><img src="/assets/img/5.3510ba14.png" alt="img5"></p> <p>Then go to 'Extensions', there you edit the applications guideline and add 'Secure Email'.</p> <p><img src="/assets/img/6.de47a406.png" alt="img6"></p> <p><img src="/assets/img/7.3114599b.png" alt="img7"></p> <h2 id="request-certificate-on-client-domain-member"><a href="#request-certificate-on-client-domain-member" class="header-anchor">#</a> Request Certificate on Client (Domain Member)</h2> <p>To request a certificate for a domain member, you have to open certmgr.msc. Right click on folder 'Personal-&gt;Certificates' and click 'All Tasks-&gt;Request New Certificate and choose the template you created on the AD.</p> <p><img src="/assets/img/8.cd912cad.png" alt="img8"></p> <p>If you did not enforce the usage of OpenPGP-CSP you have to choose it here now.</p> <p><img src="/assets/img/9.8dd469fc.png" alt="img9"></p> <p><img src="/assets/img/10.5e246912.png" alt="img10"></p> <p>Next you choose the Authentication slot for the certificate.</p> <p>You are now ready to logon on the computer with the Nitrokey instead of your password and you can use <a href="https://www.nitrokey.com/documentation/smime-email-encryption" target="_blank" rel="noopener noreferrer">S/MIME email encryption/signing<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> with the Nitrokey. The driver has to be installed on every computer you want to use the certificate on.</p> <p><img src="/assets/img/11.9b0e1c67.png" alt="img11"></p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/Nitrokey/nitrokey-documentation/edit/master/storage/windows/windows-logon-and-smime-email-encryption-with-active-directory.md" target="_blank" rel="noopener noreferrer">Help us improve this page!</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">8/13/2020, 12:15:14 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/storage/windows/two-factor-authentication-microsoft.html" class="prev">
        Two-factor Authentication for Microsoft Account
      </a></span> <span class="next"><a href="/storage/windows/2fa-nextcloud.html">
        Two-factor Authentication for Nextcloud accounts
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.a18f3569.js" defer></script><script src="/assets/js/14.cafc8b87.js" defer></script><script src="/assets/js/11.3225be1a.js" defer></script>
  </body>
</html>
