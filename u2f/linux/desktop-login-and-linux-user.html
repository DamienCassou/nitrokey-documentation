<!DOCTYPE html>
<html lang="English">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Desktop Login and Linux User Authentication | Nitrokey Documentation</title>
    <meta name="generator" content="VuePress 1.4.1">
    <link rel="icon" href="/favicon.png">
    <meta name="description" content="User documentation of all Nitrokey products">
    <link rel="preload" href="/assets/css/17.styles.11dcf1c8.css" as="style"><link rel="preload" href="/assets/js/app.123296ed.js" as="script"><link rel="preload" href="/assets/js/39.1c9eb1ed.js" as="script"><link rel="preload" href="/assets/js/33.d19c1666.js" as="script"><link rel="prefetch" href="/assets/js/0.2fce8aff.js"><link rel="prefetch" href="/assets/js/1.f20138d3.js"><link rel="prefetch" href="/assets/js/10.c80f33ef.js"><link rel="prefetch" href="/assets/js/11.562bb1e8.js"><link rel="prefetch" href="/assets/js/12.7fc93c10.js"><link rel="prefetch" href="/assets/js/13.79457bb6.js"><link rel="prefetch" href="/assets/js/14.59392d6b.js"><link rel="prefetch" href="/assets/js/15.240ff16c.js"><link rel="prefetch" href="/assets/js/16.e341580c.js"><link rel="prefetch" href="/assets/js/18.110060cd.js"><link rel="prefetch" href="/assets/js/19.a0a6d9d8.js"><link rel="prefetch" href="/assets/js/2.8f08ee03.js"><link rel="prefetch" href="/assets/js/20.e013caf2.js"><link rel="prefetch" href="/assets/js/21.9dc6cb90.js"><link rel="prefetch" href="/assets/js/22.b2c5ec86.js"><link rel="prefetch" href="/assets/js/23.58238ef3.js"><link rel="prefetch" href="/assets/js/24.395a99d4.js"><link rel="prefetch" href="/assets/js/25.3876b484.js"><link rel="prefetch" href="/assets/js/26.a6584cdf.js"><link rel="prefetch" href="/assets/js/27.acafbfb5.js"><link rel="prefetch" href="/assets/js/28.f64e6d98.js"><link rel="prefetch" href="/assets/js/29.84da01e1.js"><link rel="prefetch" href="/assets/js/3.12b0183c.js"><link rel="prefetch" href="/assets/js/30.ed034bbe.js"><link rel="prefetch" href="/assets/js/31.ee8f7f24.js"><link rel="prefetch" href="/assets/js/32.2c7a4f88.js"><link rel="prefetch" href="/assets/js/34.97b5a72a.js"><link rel="prefetch" href="/assets/js/35.29520fff.js"><link rel="prefetch" href="/assets/js/36.9464f8cd.js"><link rel="prefetch" href="/assets/js/37.64470159.js"><link rel="prefetch" href="/assets/js/4.6ef60541.js"><link rel="prefetch" href="/assets/js/40.aa62edb4.js"><link rel="prefetch" href="/assets/js/41.3ffccf57.js"><link rel="prefetch" href="/assets/js/42.ce5c0857.js"><link rel="prefetch" href="/assets/js/43.0ded9a8a.js"><link rel="prefetch" href="/assets/js/44.6c7fd27b.js"><link rel="prefetch" href="/assets/js/45.05ad9cc5.js"><link rel="prefetch" href="/assets/js/46.180d3326.js"><link rel="prefetch" href="/assets/js/47.4fffbca1.js"><link rel="prefetch" href="/assets/js/48.1d285b09.js"><link rel="prefetch" href="/assets/js/49.1c0bd2b0.js"><link rel="prefetch" href="/assets/js/5.1ce31814.js"><link rel="prefetch" href="/assets/js/50.e1fe0063.js"><link rel="prefetch" href="/assets/js/51.9ba0a3ea.js"><link rel="prefetch" href="/assets/js/52.3754f446.js"><link rel="prefetch" href="/assets/js/53.0b5c7bad.js"><link rel="prefetch" href="/assets/js/54.8cf9b30f.js"><link rel="prefetch" href="/assets/js/55.aa9e54f0.js"><link rel="prefetch" href="/assets/js/56.f5432562.js"><link rel="prefetch" href="/assets/js/57.11da233c.js"><link rel="prefetch" href="/assets/js/58.c788193d.js"><link rel="prefetch" href="/assets/js/59.084669c8.js"><link rel="prefetch" href="/assets/js/6.954fc95c.js"><link rel="prefetch" href="/assets/js/60.808a960e.js"><link rel="prefetch" href="/assets/js/61.1c92a8d1.js"><link rel="prefetch" href="/assets/js/62.6a1188ec.js"><link rel="prefetch" href="/assets/js/63.064eca91.js"><link rel="prefetch" href="/assets/js/64.781fe146.js"><link rel="prefetch" href="/assets/js/65.afbbdf45.js"><link rel="prefetch" href="/assets/js/66.5fc7fc5e.js"><link rel="prefetch" href="/assets/js/67.71eaefcd.js"><link rel="prefetch" href="/assets/js/68.ca0c4d29.js"><link rel="prefetch" href="/assets/js/69.989b2c90.js"><link rel="prefetch" href="/assets/js/7.f4714c3b.js"><link rel="prefetch" href="/assets/js/70.c5bbac0c.js"><link rel="prefetch" href="/assets/js/71.1af5f707.js"><link rel="prefetch" href="/assets/js/72.56febce0.js"><link rel="prefetch" href="/assets/js/73.494f3a61.js"><link rel="prefetch" href="/assets/js/74.f371926d.js"><link rel="prefetch" href="/assets/js/75.51764d28.js"><link rel="prefetch" href="/assets/js/76.b5f9aaa4.js"><link rel="prefetch" href="/assets/js/77.75e6b404.js"><link rel="prefetch" href="/assets/js/78.e3e091e9.js"><link rel="prefetch" href="/assets/js/79.2bdaba80.js"><link rel="prefetch" href="/assets/js/8.5c752617.js"><link rel="prefetch" href="/assets/js/80.4ad08856.js"><link rel="prefetch" href="/assets/js/81.80d850f1.js"><link rel="prefetch" href="/assets/js/82.87ba4d0f.js"><link rel="prefetch" href="/assets/js/83.f8b43937.js"><link rel="prefetch" href="/assets/js/84.faa67df9.js"><link rel="prefetch" href="/assets/js/85.24698794.js"><link rel="prefetch" href="/assets/js/86.2844e49d.js"><link rel="prefetch" href="/assets/js/87.55150a83.js"><link rel="prefetch" href="/assets/js/9.5e13f527.js">
    <link rel="stylesheet" href="/assets/css/17.styles.11dcf1c8.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/nitrokey_logo_nur_schild_rot.svg" alt="Nitrokey Documentation" class="logo"> <span class="site-name can-hide">Nitrokey Documentation</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Product Menu" class="dropdown-title"><span class="title">Products</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fido2/" class="nav-link">
  Nitrokey FIDO2
</a></li><li class="dropdown-item"><!----> <a href="/u2f/" class="nav-link router-link-active">
  Nitrokey FIDO U2F
</a></li><li class="dropdown-item"><!----> <a href="/hsm/" class="nav-link">
  Nitrokey HSM
</a></li><li class="dropdown-item"><!----> <a href="/pro/" class="nav-link">
  Nitrokey Pro
</a></li><li class="dropdown-item"><!----> <a href="/start/" class="nav-link">
  Nitrokey Start
</a></li><li class="dropdown-item"><!----> <a href="/storage/" class="nav-link">
  Nitrokey Storage
</a></li><li class="dropdown-item"><!----> <a href="/x230/" class="nav-link">
  NitroPad X230
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/u2f/linux/desktop-login-and-linux-user.html" class="nav-link router-link-exact-active router-link-active">
  English
</a></li><li class="dropdown-item"><!----> <a href="/de/" class="nav-link">
  Deutsch
</a></li></ul></div></div> <a href="https://github.com/Nitrokey/nitrokey-documentation" target="_blank" rel="noopener noreferrer" class="repo-link">
    Contribute!
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Product Menu" class="dropdown-title"><span class="title">Products</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fido2/" class="nav-link">
  Nitrokey FIDO2
</a></li><li class="dropdown-item"><!----> <a href="/u2f/" class="nav-link router-link-active">
  Nitrokey FIDO U2F
</a></li><li class="dropdown-item"><!----> <a href="/hsm/" class="nav-link">
  Nitrokey HSM
</a></li><li class="dropdown-item"><!----> <a href="/pro/" class="nav-link">
  Nitrokey Pro
</a></li><li class="dropdown-item"><!----> <a href="/start/" class="nav-link">
  Nitrokey Start
</a></li><li class="dropdown-item"><!----> <a href="/storage/" class="nav-link">
  Nitrokey Storage
</a></li><li class="dropdown-item"><!----> <a href="/x230/" class="nav-link">
  NitroPad X230
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/u2f/linux/desktop-login-and-linux-user.html" class="nav-link router-link-exact-active router-link-active">
  English
</a></li><li class="dropdown-item"><!----> <a href="/de/" class="nav-link">
  Deutsch
</a></li></ul></div></div> <a href="https://github.com/Nitrokey/nitrokey-documentation" target="_blank" rel="noopener noreferrer" class="repo-link">
    Contribute!
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><a href="/u2f/linux/" class="sidebar-link">Nitrokey FIDO U2F, Linux</a></li><li><a href="/u2f/linux/two-factor-authentication-for-erp-software-odoo.html" class="sidebar-link">Two-factor authentication for ERP software Odoo</a></li><li><a href="/u2f/linux/desktop-login-and-linux-user.html" class="active sidebar-link">Desktop Login and Linux User Authentication</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/u2f/linux/desktop-login-and-linux-user.html#introduction" class="sidebar-link">Introduction</a></li><li class="sidebar-sub-header"><a href="/u2f/linux/desktop-login-and-linux-user.html#instructions" class="sidebar-link">Instructions</a></li><li class="sidebar-sub-header"><a href="/u2f/linux/desktop-login-and-linux-user.html#usage" class="sidebar-link">Usage</a></li></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="desktop-login-and-linux-user-authentication"><a href="#desktop-login-and-linux-user-authentication" class="header-anchor">#</a> Desktop Login and Linux User Authentication</h1> <h2 id="introduction"><a href="#introduction" class="header-anchor">#</a> Introduction</h2> <p>This guide will walk you through the configuration of Linux to use FIDO Universal 2nd Factor, i.e. FIDO U2F with <code>libpam-u2f</code> and <a href="https://shop.nitrokey.com/shop/product/nk-fi2-nitrokey-fido2-55" target="_blank" rel="noopener noreferrer">Nitrokey FIDO2<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> .</p> <p>If you want to login to you computer using <a href="https://shop.nitrokey.com/shop/product/nk-pro-2-nitrokey-pro-2-3" target="_blank" rel="noopener noreferrer">Nitrokey Pro 2,<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> <a href="https://shop.nitrokey.com/shop/product/nitrokey-storage-2-56" target="_blank" rel="noopener noreferrer">Nitrokey Storage 2<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> and <a href="https://shop.nitrokey.com/shop/product/nk-sta-nitrokey-start-6" target="_blank" rel="noopener noreferrer">Nitrokey Start<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> you can visit the instructions for Windows available <a href="https://www.nitrokey.com/documentation/applications#computer-login" target="_blank" rel="noopener noreferrer">here<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, and for Linux <a href="https://www.nitrokey.com/documentation/applications#computer-login" target="_blank" rel="noopener noreferrer">here<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> .</p> <h3 id="requirements"><a href="#requirements" class="header-anchor">#</a> Requirements</h3> <ul><li>Ubuntu 20.04 with Gnome Display Manager.</li> <li>Nitrokey FIDO2 configured following <a href="https://www.nitrokey.com/documentation/installation#p:nitrokey-fido-u2f&amp;os:linux" target="_blank" rel="noopener noreferrer">these instructions<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</li></ul> <h2 id="instructions"><a href="#instructions" class="header-anchor">#</a> Instructions</h2> <h3 id="preparation"><a href="#preparation" class="header-anchor">#</a> Preparation</h3> <h4 id="_1-set-up-backup-user"><a href="#_1-set-up-backup-user" class="header-anchor">#</a> 1. Set up <code>&lt;backup_user&gt;</code></h4> <p>This step is not necessary for the setup, however it is recommended as fall-back if you are testing user-specific instructions.</p> <h5 id="gui-method"><a href="#gui-method" class="header-anchor">#</a> GUI method</h5> <ol><li>In the lower left corner click on <code>Show Applications</code> and type settings in the search bar as following:</li></ol> <p><img src="/assets/img/fidou2f-1.572ee8e9.png" alt=""></p> <ol start="2"><li>Scroll down in the right bar to <code>Users</code></li></ol> <p><img src="/assets/img/fidou2f-2.832e0b43.png" alt=""></p> <ol start="3"><li>In the left corner click on <code>Unlock</code> and that would prompt for your password</li> <li>Select <code>Administrator</code> and enter the user name and password of your choice</li></ol> <p><img src="/assets/img/fidou2f-4.fb7f9439.png" alt=""></p> <ol start="5"><li>Once you finish Step 4 you should be done</li></ol> <p><img src="/assets/img/fidou2f-5.e6f3421c.png" alt=""></p> <h5 id="cli-method"><a href="#cli-method" class="header-anchor">#</a> CLI method</h5> <p>Create a backup user, and give it root privileges with these commands:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">sudo</span> adduser <span class="token operator">&lt;</span>backup_user<span class="token operator">&gt;</span>
$ <span class="token function">sudo</span> <span class="token function">usermod</span> -aG <span class="token function">sudo</span> <span class="token operator">&lt;</span>backup_user<span class="token operator">&gt;</span>
</code></pre></div><p>In case you prefer to setup U2F for a single user, and are locked out of your user session, you would still be able to login with the <code>&lt;backup_user&gt;</code>, and proceed with the maintenance.</p> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>The following guide can potentially lock you out of your computer. You should be aware of these risks, as it is recommended to first use the instructions below on a secondary computer, or after a full backup.</p> <p>You might lose access to your data after configuring <a href="http://www.linux-pam.org/Linux-PAM-html/" target="_blank" rel="noopener noreferrer">PAM modules<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p></div> <h4 id="_2-set-up-the-rules-to-recognize-the-nitrokey-fido2"><a href="#_2-set-up-the-rules-to-recognize-the-nitrokey-fido2" class="header-anchor">#</a> 2. Set up the <code>rules</code> to recognize the Nitrokey FIDO2</h4> <p>Under <code>/etc/udev/rules.d</code> download <code>41-nitrokey.rules</code></p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token builtin class-name">cd</span> /etc/udev/rules.d/
$ <span class="token function">sudo</span> <span class="token function">wget</span> https://raw.githubusercontent.com/Nitrokey/libnitrokey/master/data/41-nitrokey.rules
</code></pre></div><p>And restart <code>udev</code> service</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">sudo</span> systemctl restart udev
</code></pre></div><h4 id="_3-install-libpam-u2f"><a href="#_3-install-libpam-u2f" class="header-anchor">#</a> 3. Install <code>libpam-u2f</code></h4> <p>On Ubuntu 20.04 it is possible to download directly <code>ibpam-u2f</code> from the official repos</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> libpam-u2f
</code></pre></div><details class="custom-block details"><summary>Click for more options</summary> <ul><li>Alternatively you can build <code>libpam-u2f</code> from <a href="https://github.com/phoeagon/pam-u2f" target="_blank" rel="noopener noreferrer">Git<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</li> <li>To verify that the library is properly installed enter the following command:</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">file</span> /lib/x86_64-linux-gnu/security/pam_u2f.so
</code></pre></div><p>The Output should be something like the following:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>/lib/x86_64-linux-gnu/security/pam_u2f.so: <span class="token punctuation">\</span> ELF <span class="token number">64</span>-bit LSB shared object, x86-64, version <span class="token number">1</span> <span class="token punctuation">(</span>SYSV<span class="token punctuation">)</span>,<span class="token punctuation">\</span> dynamically linked, BuildID<span class="token punctuation">[</span>sha1<span class="token punctuation">]</span><span class="token operator">=</span>1d55e1b11a97be2038c6a139579f6c0d91caedb1, stripped
</code></pre></div></details> <h4 id="_4-prepare-the-directory"><a href="#_4-prepare-the-directory" class="header-anchor">#</a> 4. Prepare the Directory</h4> <p>Create <code>.config/Nitrokey/</code> under your home directory</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">mkdir</span> ~/.config/Nitrokey
</code></pre></div><p>And plug your Nitrokey FIDO2.</p> <h3 id="configuration"><a href="#configuration" class="header-anchor">#</a> Configuration</h3> <p>Once done with the preparation, we can start to configure the computer to use the Nitrokey FIDO2 for 2nd factor authentication at login and <code>sudo</code>.</p> <h4 id="_5-generate-the-u2f-config-file"><a href="#_5-generate-the-u2f-config-file" class="header-anchor">#</a> 5. Generate the U2F config file</h4> <p>To generate the configuration file we will use the <code>pamu2fcfg</code> utility that comes with the <code>libpam-u2f</code>.
For convenience, we will directly write the output of the utility to the <code>u2f_keys</code> file under <code>.config/Nitrokey</code>.
First plug your Nitrokey FIDO2 (if you did not already), and enter the following command:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ pamu2fcfg <span class="token operator">&gt;</span> ~/.config/Nitrokey/u2f_keys
</code></pre></div><p>Once you run the command above, you will need to touch the key while it flashes. Once done, <code>pamu2fcfg</code> will append its output the <code>u2f_keys</code> in the following format:</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&lt;</span>username<span class="token operator">&gt;</span>:Zx<span class="token punctuation">..</span>.mw,04<span class="token punctuation">..</span>.0a
</code></pre></div><p>Note, the output will be much longer, but sensitive parts have been removed here.
For better security, and once the config file generated, we will move the <code>.config/Nitrokey</code> directory under the <code>etc/</code> directory with this command:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">sudo</span> <span class="token function">mv</span> ~/.config/Nitrokey /etc	
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <ul><li>The file under <code>.config/Nitrokey</code> must be named <code>u2f_keys</code></li> <li>It is recommended to first test the instructions with a single user. For this purpose the previous command takes the <code>-u</code> option, to specify a user, like in the example below:</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code>$ pamu2fcfg -u <span class="token operator">&lt;</span>username<span class="token operator">&gt;</span> <span class="token operator">&gt;</span> ~/.config/Nitrokey/u2f_keys
</code></pre></div><ul><li>For individual user configuration you should point to the home directory in the next step, or not include the <code>authfile</code> option in the PAM configuration.</li></ul></div> <h4 id="_6-backup"><a href="#_6-backup" class="header-anchor">#</a> 6. Backup</h4> <p>This step is optional, however it is advised to have a backup Nitrokey in the case of loss, theft or destruction of your Nitrokey FIDO.</p> <p>To set up a backup key, repeat the procedure above, and use <code>pamu2fcfg -n</code>. This will omit the <code>&lt;username&gt;</code> field, and the output can be appended to the line with your <code>&lt;username&gt;</code> like this:</p> <div class="language- extra-class"><pre class="language-text"><code>&lt;username&gt;:Zx...mw,04...0a:xB...fw,04...3f
</code></pre></div><h4 id="_7-modify-the-pluggable-authentication-module-pam"><a href="#_7-modify-the-pluggable-authentication-module-pam" class="header-anchor">#</a> 7. Modify the Pluggable Authentication Module <code>PAM</code></h4> <p>The final step is configure the PAM module files under <code>/etc/pam.d/</code>.
In this guide we will modify the <code>common-auth</code> file as it handles the authentication settings which are common to all services, but other options are possible.
You can modify the file with the following command:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token builtin class-name">cd</span> /etc/pam.d
$ <span class="token function">sudo</span> <span class="token variable">$editor</span> common-auth
</code></pre></div><p>And add the following lines:</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment">#Nitrokey FIDO2 config </span>
auth	sufficient pam_u2f.so <span class="token assign-left variable">authfile</span><span class="token operator">=</span>/etc/Nitrokey/u2f_keys cue prompt 
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <ul><li>Since we are using Central Authentication Mapping, we need to tell <code>pam_u2f</code> the location of the file to use with the <code>authfile</code> option.</li> <li>If you often forget to insert the key, <code>prompt</code> option make <code>pam_u2f</code> print <code>Insert your U2F device, then press ENTER.</code> and give you a chance to insert the Nitrokey.</li> <li>If you would like to be prompted to touch the Nitrokey, <code>cue</code> option will make <code>pam_u2f</code> print <code>Please touch the device.</code> message.</li></ul></div> <p>Once we modified the <code>common-auth</code>, we can save and exit the file.</p> <p>You can test the configuration by typing <code>sudo ls</code> in the terminal. You should be prompted the message <code>Please touch the device.</code> and have a similar output on the terminal:</p> <div class="language-bash nitrouser@nitrouser:~$ sudo ls extra-class"><pre class="language-bash"><code>$ <span class="token function">sudo</span> <span class="token function">ls</span>
<span class="token punctuation">[</span>sudo<span class="token punctuation">]</span> password <span class="token keyword">for</span> <span class="token operator">&lt;</span>username<span class="token operator">&gt;</span>: 
Please <span class="token function">touch</span> the device.
</code></pre></div><p>You can also test your configuration by logging out of the user session and logging back. A similar screen should be displayed once you you unplug/replug yout Nitrokey FIDO2 and type your password:</p> <p><img src="/assets/img/u2f-fido-pam-2.c739d7d3.png" alt=""></p> <h2 id="usage"><a href="#usage" class="header-anchor">#</a> Usage</h2> <p>After the PAM module modification, you will be able to test your configuration right away, but it is recommended to reboot your computer, and unplug/replug the Nitrokey FIDO2.</p> <p>Once you have properly tested the instructions in this guide (and set up a backup), it is recommended to use either the <code>required</code> or the <code>requisite</code> control flag instead of <code>sufficient</code>.</p> <p>The flags <code>required</code> and <code>requisite</code> provide a tighter access control, and will make the Nitrokey FIDO2 necessary to login, and/or use the configured service.</p> <p>If you need more information about Control Flags in the <code>PAM</code> configuration line, you may see the last section of this guide to understand the difference, and the implications of using each of them.</p> <h4 id="pam-modules"><a href="#pam-modules" class="header-anchor">#</a> PAM modules</h4> <p>There are several PAM modules files that can be modified according to your needs:</p> <ul><li>By modifying <code>/etc/pam.d/common-auth</code> file, you will be able to use you Nitrokey FIDO for 2nd factor authentication for graphic login and <code>sudo</code>.
Note: <code>common-auth</code> should be modified by adding the additional configuration line at the end of the file.</li> <li>If you wish to use FIDO U2F authentication solely for Gnome's graphic login, you might prefer to modify the<code>/etc/pam.d/gdm-password</code></li> <li>Alternatively you can just modify the <code>/etc/pam.d/sudo</code> file if you wish to use FIDO U2F when using the <code>sudo</code> command.</li></ul> <h4 id="control-flags"><a href="#control-flags" class="header-anchor">#</a> Control flags</h4> <p>In step 7 we have used the <code>sufficient</code> control flag to determine the behavior of the PAM module when the Nitrokey is plugged or not. However it is possible to change this behavior by using the following control flags:</p> <ul><li><code>required</code>: This is the most critical flag. The module result must be successful for authentication to continue. This flag can lock you out of your computer if you do not have access to the Nitrokey.</li> <li><code>requisite</code>: Similar to <code>required</code> however, in the case where a specific module returns a failure, control is directly returned to the application, or to the superior PAM stack. This flag can also lock you out of your computer if you do not have access to the Nitrokey.</li> <li><code>sufficient</code>: The module result is ignored if it fails. The <code>sufficient</code> flag considered to be safe for testing purposes.</li> <li><code>optional</code>: The success or failure of this module is only important if it is the only module in the stack associated with this service+type. The <code>optional</code> flag is considered to be safe to use for testing purposes.</li></ul> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <ul><li><p>If <code>required</code>  or <code>requisite</code> is set, the failure of U2F authentication will cause a failure of the overall authentication. Failure will occur when the configured Nitrokey FIDO is not plugged, lost or destroyed.</p></li> <li><p>You will lose access to your computer if you mis-configured the PAM module <em>and</em> used the <code>required</code> or <code>requisite</code> flags.</p></li> <li><p>You will also lose the ability to use <code>sudo</code> if you set up Central Authentication Mapping <em>and</em> used the <code>required</code> or <code>requisite</code> flags.</p></li></ul></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/Nitrokey/nitrokey-documentation/edit/master/u2f/linux/desktop-login-and-linux-user.md" target="_blank" rel="noopener noreferrer">Help us improve this page!</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">1/12/2021, 6:52:41 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/u2f/linux/two-factor-authentication-for-erp-software-odoo.html" class="prev">
        Two-factor authentication for ERP software Odoo
      </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.123296ed.js" defer></script><script src="/assets/js/39.1c9eb1ed.js" defer></script><script src="/assets/js/33.d19c1666.js" defer></script>
  </body>
</html>
