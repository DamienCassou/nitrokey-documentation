(window.webpackJsonp=window.webpackJsonp||[]).push([[29],{531:function(e,t,s){"use strict";s.r(t);var a=s(33),r=Object(a.a)({},(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("h1",{attrs:{id:"automatic-screen-lock-at-removal"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#automatic-screen-lock-at-removal"}},[e._v("#")]),e._v(" Automatic Screen Lock at Removal")]),e._v(" "),s("p",[e._v("This guide will walk you through the configuration of your computer, to automatically lock your session when you remove the Nitrokey.")]),e._v(" "),s("p",[e._v("The configuration requires the creation of two files under two different directories.")]),e._v(" "),s("h3",{attrs:{id:"requirements"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#requirements"}},[e._v("#")]),e._v(" Requirements")]),e._v(" "),s("ul",[s("li",[e._v("Ubuntu 20.04 or Debian 10 (Buster), both with "),s("a",{attrs:{href:"https://wiki.gnome.org/Projects/GDM",target:"_blank",rel:"noopener noreferrer"}},[e._v("Gnome Display Manager"),s("OutboundLink")],1),e._v(" installed.")]),e._v(" "),s("li",[e._v("Nitrokey Pro 2, Nitrokey Storage 2, or Nitrokey HSM 2")])]),e._v(" "),s("h2",{attrs:{id:"configuration"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#configuration"}},[e._v("#")]),e._v(" Configuration")]),e._v(" "),s("h4",{attrs:{id:"create-the-rules-file"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#create-the-rules-file"}},[e._v("#")]),e._v(" Create the "),s("code",[e._v(".rules")]),e._v(" file")]),e._v(" "),s("p",[e._v("With your favorite text editor create a file called "),s("code",[e._v("85-nitrokey.rules")])]),e._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[e._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" editor /etc/udev/rules.d/85-nitrokey.rules\n")])])]),s("p",[e._v("Add the following line to the file")]),e._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("ACTION")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("==")]),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"remove"')]),e._v(", ENV"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("PRODUCT"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("==")]),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"20a0/4108/101"')]),e._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("RUN")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("+=")]),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"/usr/local/bin/gnome-screensaver-lock"')]),e._v("\n")])])]),s("p",[e._v("Save the file and quit the editor.")]),e._v(" "),s("p",[e._v("This file sets up a new hardware rule that executes the "),s("code",[e._v("gnome-screensaver-lock")]),e._v(" at removal of the Nitrokey device.")]),e._v(" "),s("p",[e._v("You should change the configuration according to the device you are using as following:")]),e._v(" "),s("ul",[s("li",[e._v("Nitrokey Pro: "),s("code",[e._v('ENV{PRODUCT}=="20a0/4108/101"')])]),e._v(" "),s("li",[e._v("Nitrokey HSM: "),s("code",[e._v('ENV{PRODUCT}=="20a0/4230/101"')])]),e._v(" "),s("li",[e._v("Nitrokey Storage: "),s("code",[e._v('ENV{PRODUCT}=="20a0/4109/101"')])])]),e._v(" "),s("h4",{attrs:{id:"create-the-gnome-screensaver-lock-script"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#create-the-gnome-screensaver-lock-script"}},[e._v("#")]),e._v(" Create the "),s("code",[e._v("gnome-screensaver-lock")]),e._v(" script")]),e._v(" "),s("p",[e._v("With your favorite text editor create a file called "),s("code",[e._v("gnome-screensaver-lock")])]),e._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[e._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" editor /usr/local/bin/gnome-screensaver-lock\n")])])]),s("p",[e._v("Add the following text")]),e._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("user")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[e._v("`")]),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("ps")]),e._v(" axo user:30,comm "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("egrep")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"gdm-(wayland|x)"')]),e._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("awk")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v("'{print "),s("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$1")]),e._v("}'")]),s("span",{pre:!0,attrs:{class:"token variable"}},[e._v("`")])]),e._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("if")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v(" -n "),s("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$user")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("then")]),e._v("\n        "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("su")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$user")]),e._v(" -c "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"/usr/bin/dbus-send --type=method_call --dest=org.gnome.ScreenSaver /org/gnome/ScreenSaver org.gnome.ScreenSaver.Lock"')]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("fi")]),e._v("\n")])])]),s("p",[e._v("In the first step, this script looks for the user-name of the gnome session, i.e. "),s("code",[e._v("user")]),e._v(".")]),e._v(" "),s("p",[e._v("When it is called at Nitrokey removal, the script queries "),s("code",[e._v("user")]),e._v(", switches to its session, and locks the screen by prompting the screen-saver screen.")]),e._v(" "),s("h4",{attrs:{id:"execute-the-script"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#execute-the-script"}},[e._v("#")]),e._v(" Execute the script")]),e._v(" "),s("p",[e._v("Once all set up, execute the script once, and it will lock the screen. It does not matter if the Nitrokey is plugged or not for this first execution.")]),e._v(" "),s("h2",{attrs:{id:"usage"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#usage"}},[e._v("#")]),e._v(" Usage")]),e._v(" "),s("p",[e._v("By now you can log back to your session by entering your password, and (re)plug you Nitrokey if you did not do it before.")]),e._v(" "),s("p",[e._v("The next time(s) you unplug your Nitrokey from the computer, it will automatically lock the screen.")])])}),[],!1,null,null,null);t.default=r.exports}}]);